#+TITLE: Sean Miller’s Emacs Configuration
#+STARTUP: showall

* Emacs Config

** Defaults

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    ;; -- disable stuff ----------------------------------------------------------
    (setq make-backup-files nil)
    (setq auto-save-default nil)
    (setq inhibit-startup-message t)
    (fset 'yes-or-no-p 'y-or-n-p)
    (menu-bar-mode -1)

    ;; -- rows and columns -------------------------------------------------------
    (setq line-number-mode t)
    (setq column-number-mode t)
    (setq linum-format "%4d ")
    (setq-default fill-column 80)

    ;; -- windmove ---------------------------------------------------------------
    (define-key input-decode-map "\e[1;2A" [S-up])
    (windmove-default-keybindings)
    (setq windmove-wrap-around t)

    (require 'projectile)
    (setq projectile-keymap-prefix (kbd "C-c p"))
    (projectile-global-mode)
    (setq projectile-completion-system 'default)
    ;; -- avoid ruby deep indent -------------------------------------------------
    (setq ruby-deep-indent-paren nil)

    ;; -- delete trailing whitespace ---------------------------------------------
    (add-hook 'before-save-hook 'delete-trailing-whitespace)
#+END_SRC

** Mode hooks

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (typo-global-mode 1)

    (defun my-text-mode-hook ()
      (typo-mode)
      (typo-change-language "English")
      (linum-mode -1)
      (auto-fill-mode 1)
      (nanowrimo-mode -1)
      (set-input-method "TeX")
      (define-key org-mode-map (kbd "M-s M-q") 'my/begin-end-quote)
      (define-key org-mode-map (kbd "M-s M-v") 'my/begin-end-verse)
      (define-key org-mode-map (kbd "M-s M-x") 'my/begin-end-example)
      (define-key org-mode-map (kbd "M-s M-e") 'my/begin-end-src-emacs-lisp)
      (define-key org-mode-map (kbd "M-s M-r") 'my/begin-end-src-ruby)
    )

    (add-hook 'text-mode-hook 'my-text-mode-hook)

    (defun my-code-mode-hook ()
      (linum-mode)
      (typo-mode -1))

    (add-to-list 'auto-mode-alist '("\\.rb$" . enh-ruby-mode))
    (add-to-list 'interpreter-mode-alist '("ruby" . enh-ruby-mode))

    (add-hook 'enh-ruby-mode-hook 'my-code-mode-hook)
    (add-hook 'enh-ruby-mode-hook
      (lambda () (rvm-activate-corresponding-ruby)))
    (add-hook 'enh-ruby-mode-hook 'rubocop-mode)

    (add-hook 'feature-mode-hook 'my-code-mode-hook)
    (add-hook 'feature-mode-hook
      (lambda () (rvm-activate-corresponding-ruby)))

    (require 'js2-refactor)
    (add-hook 'js-mode-hook 'my-code-mode-hook)
    (add-hook 'js-mode-hook
      (lambda () (js2-mode)))

    (add-hook 'emacs-lisp-mode-hook 'my-code-mode-hook)

    (require 'projectile-rails)
    (add-hook 'projectile-mode-hook 'projectile-rails-on)

    (require 'overseer)
    (add-hook 'emacs-lisp-mode-hook 'overseer-mode-hook)
#+END_SRC

** Global key bindings

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (global-set-key (kbd "C-c f") 'projectile-find-file)
    (global-set-key (kbd "C-c h") 'helm-projectile)

    (global-set-key (kbd "C-S-c C-S-c") 'mc/edit-lines)

    (global-set-key (kbd "C->") 'mc/mark-next-like-this)
    (global-set-key (kbd "C-<") 'mc/mark-previous-like-this)
    (global-set-key (kbd "C-c C-<") 'mc/mark-all-like-this)

    (global-set-key (kbd "C-c SPC") 'ace-jump-mode)
    (global-set-key (kbd "C-x o") 'ace-window)

    ;; http://whattheemacsd.com/key-bindings.el-03.html

    (global-set-key (kbd "M-j")
      (lambda ()
	(interactive)
	(join-line -1)))

    ;;

    (global-set-key (kbd "C-c r g q")
      (lambda ()
	(interactive)
	(find-file "db/structure.sql")))

    ;; Because S-<up> is already mapped in org-mode
    (global-set-key (kbd "C-x RET <right>") 'windmove-right)
    (global-set-key (kbd "C-x RET <left>") 'windmove-left)
    (global-set-key (kbd "C-x RET <up>") 'windmove-up)
    (global-set-key (kbd "C-x RET <down>") 'windmove-down)

    ;; Because M–i is tab-to-tab-stop in org-mode
    (global-set-key (kbd "M-s i") 'imenu)
#+END_SRC

** Emacs server and Emacsclient

Setting up server for emacsclient, following
- http://devblog.avdi.org/2010/04/23/daemonic-emacs/
- http://devblog.avdi.org/2011/10/27/running-emacs-as-a-server-emacs-reboot-15/

To use it: create and chmod +x /usr/local/bin/ec

#+BEGIN_SRC bash :tangle no
    #!/bin/sh
    exec /usr/bin/env emacsclient -c -a '' $*
#+END_SRC

and add export EDITOR=ec to ~/.zshrc

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (server-start)
#+END_SRC

** Dired

Sets Dired Omit Mode to omit “uninteresting” files (default ., .., autosave files)

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (require 'dired-x)
    (setq-default dired-omit-files-p t)
#+END_SRC

Maked Dired less verbose, following: http://whattheemacsd.com/setup-dired.el-01.html

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (require 'dired-details)
    (setq-default dired-details-hidden-string "--- ")
    (dired-details-install)
#+END_SRC

Get M-< and M-> to play nice in Dired (first file and last file, not top and
bottom), following:  http://whattheemacsd.com/setup-dired.el-02.html

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (defun dired-back-to-top ()
      (interactive)
      (beginning-of-buffer)
      (dired-next-line (if dired-omit-mode 1 4)))

    (define-key dired-mode-map
      (vector 'remap 'beginning-of-buffer) 'dired-back-to-top)

    (defun dired-jump-to-bottom ()
      (interactive)
      (end-of-buffer)
      (dired-next-line -1))

    (define-key dired-mode-map
      (vector 'remap 'end-of-buffer) 'dired-jump-to-bottom)
#+END_SRC

** Ruby and RSpec

RSpec Mode

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (require 'rspec-mode)

    (setq rspec-use-rvm t)
    (setq rspec-use-rake-when-possible nil)
    (setq rspec-use-zeus-when-possible t)

    (defadvice rspec-compile (around rspec-compile-around)
      "Use BASH shell for running the specs because of ZSH issues."
      (let ((shell-file-name "/bin/bash"))
	ad-do-it))
    (ad-activate 'rspec-compile)

    (eval-after-load 'rspec-mode
      '(rspec-install-snippets))
#+END_SRC

Ruby Tools Mode, including senny-ruby-interpolate from
http://blog.senny.ch/blog/2012/10/06/emacs-tidbits-for-ruby-developers/

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (require 'ruby-tools)

    (global-set-key
      (kbd "C-c q")
      (defhydra hydra-ruby-tools-quote (:color blue)
        "ruby-tools-quote"
        (":" (ruby-tools-to-symbol) "to symbol")
        ("s" (ruby-tools-to-single-quote-string) "to single-quoted string")
        ("d" (ruby-tools-to-double-quote-string) "to double-quoted string")))

    (defun senny-ruby-interpolate ()
      "In a double quoted string, interpolate."
      (interactive)
      (insert "#")
      (when (and
	     (looking-back "\".*")
	     (looking-at ".*\""))
	(insert "{}")
	(backward-char 1)))

    (eval-after-load 'enh-ruby-mode
      '(progn
	 (define-key enh-ruby-mode-map (kbd "#") 'senny-ruby-interpolate)))
#+END_SRC

Flymake Ruby

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (require 'flymake-ruby)
    (add-hook 'enh-ruby-mode-hook 'flymake-ruby-load)
#+END_SRC

Robe

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (require 'robe)
    (add-hook 'enh-ruby-mode-hook 'robe-mode)

    (defadvice inf-ruby-console-auto (before activate-rvm-for-robe activate)
      (rvm-activate-corresponding-ruby))

    (package-initialize)
    (global-company-mode)
    (push 'company-robe company-backends)
#+END_SRC

** Org Mode

Publish ~/Dropbox/gesta org to ~/Dropbox/gesta_html

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (setq org-export-with-sub-superscripts nil)

    (global-set-key (kbd "C-c C-g C-p")
		    (lambda ()
		      (interactive)
		      (org-publish-project "org")))

    (require 'ox-publish)
    (setq org-publish-project-alist
	  '(
	    ("org"
	     :base-directory "~/Dropbox/gesta/"
	     :base-extension "org"
	     :publishing-directory "~/Dropbox/gesta_html/"
	     :recursive t
	     :publishing-function org-html-publish-to-html
	     :headline-levels 4             ; Just the default for this project.
	     :auto-preamble t
	     )
	    ))
#+END_SRC

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (org-babel-do-load-languages
     'org-babel-load-languages
      '( (ruby . t)
	 (emacs-lisp . t)
       ))

    (defun cid (custom-id)
      (interactive "MCUSTOM_ID: ")
      (org-set-property "CUSTOM_ID" custom-id))

    (setq org-default-notes-file "~/Dropbox/gesta/notes.org")
    (define-key global-map "\C-cc" 'org-capture)
    (setq org-capture-templates
      '(
        ("c" "culture-link-note" plain
          (function my/next-in-gesta)
          "**** %<%H:%M>. %^{prompt} :culture:links:\n\n%?"
          :empty-lines 1
        )
        ("e" "emacs-note" plain
          (function my/next-in-gesta)
          "**** %<%H:%M>. %^{prompt} :emacs:\n\n%?"
          :empty-lines 1
        )
        ("f" "fiction-note" plain
          (function my/next-in-gesta)
          "**** %<%H:%M>. %^{prompt} :fiction:\n\n%?"
          :empty-lines 1
        )
        ("l" "labwork-note" plain
          (function my/next-in-gesta)
          "**** %<%H:%M>. %^{prompt} :labwork:\n\n%?"
          :empty-lines 1
        )
        ("m" "morning-note" plain
          (function my/next-in-gesta)
          "**** %<%H:%M>. Morning :morning:\n\n%?"
          :empty-lines 1
        )
        ("t" "tech-link-note" plain
          (function my/next-in-gesta)
          "**** %<%H:%M>. %^{prompt} :tech:links:\n\n%?"
          :empty-lines 1
        )
        ("u" "untagged-note" plain
          (function my/next-in-gesta)
          "**** %<%H:%M>. %^{prompt}\n\n%?"
          :empty-lines 1
        )
        ("v" "verdour-note" plain
          (function my/next-in-gesta)
          "**** %<%H:%M>. %^{prompt} :verdour:\n\n%?"
          :empty-lines 1
        )
      )
    )

    (defun my/next-in-gesta ()
      (find-file "~/Dropbox/gesta/2015.org")
      (my/find-or-create-date-headers (format-time-string "%Y-%m-%d 09:00"))
      (org-end-of-subtree)
    )

    (defun my-org-capture-mode-hook ()
      (nanowrimo-mode 1)
    )
    (add-hook 'org-capture-mode-hook 'my-org-capture-mode-hook)

    (define-key global-map "\C-ca" 'org-agenda)
#+END_SRC

-----

** my/begin-end custom functions

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-code.el
    (defun my/begin-end-quote ()
      (interactive)
      (my/begin-end "quote" "quote"))

    (defun my/begin-end-verse ()
      (interactive)
      (my/begin-end "verse" "verse"))

    (defun my/begin-end-example ()
      (interactive)
      (my/begin-end "example" "example"))

    (defun my/begin-end-src-emacs-lisp ()
      (interactive)
      (my/begin-end "src emacs-lisp" "src"))

    (defun my/begin-end-src-ruby ()
      (interactive)
      (my/begin-end "src ruby" "src"))

    (defun my/begin-end (begin-tag end-tag)
      (interactive)
      (let ((cited-string "\n"))
	(when (use-region-p)
	  (setq cited-string
		(my/remove-old-citation-formatting (buffer-substring-no-properties (region-beginning) (region-end))))
	  (delete-region (region-beginning) (region-end)))
	(insert "#+begin_" begin-tag "\n"
		cited-string
		"#+end_" end-tag "\n"))
	(unless (use-region-p)
	  (forward-line -2)))

    (defun my/remove-old-citation-formatting (str)
      (interactive)
      (if (string= (substring str 0 2) "> ")
	  (replace-regexp-in-string "^> " "    "
				    (replace-regexp-in-string "\s*<br/>" ""
							      (replace-regexp-in-string "    $" ""
								(replace-regexp-in-string "\n" "\n    " str))))
	str))
#+END_SRC

** org2blog to WordPress

Taking the org2blog instructions from
http://vxlabs.com/2014/05/25/emacs-24-with-prelude-org2blog-and-wordpress/

but following the org2blog README and using auth-source instead of netrc:
https://github.com/punchagan/org2blog/commit/52be89507c337e5f74be831ca563a8023e0ec736

Expects an ~/.authinfo file of the form:
machine {my-machine-name} login {my-elogin} password {my-password}

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (setq org-directory "~/Dropbox/gesta/twc/")
    ;; and you need this, else you'll get symbol void errors when doing
    ;; fill paragraph
    (setq org-list-allow-alphabetical t)

    (require 'org2blog-autoloads)
    (require 'auth-source)
    (let (credentials)
	    (add-to-list 'auth-sources "~/.authinfo")
	    (setq credentials (auth-source-user-and-password "thewanderingcoder"))
	    (setq org2blog/wp-blog-alist
		  `(("twc"
		     :url "http://thewanderingcoder.com/xmlrpc.php"
		     :username ,(car credentials)
		     :password ,(cadr credentials)
		     :default-title "Hello World"
		     :default-categories ("org2blog" "emacs")
		     :tags-as-categories nil))))

    ;; http://blog.binchen.org/posts/how-to-use-org2blog-effectively-as-a-programmer.html
    ;; has half the instructions, but was missing
    ;; `wp-use-sourcecode-shortcode` at the time of this writing, without
    ;; which this does not work at all.

    ;; * `M-x package-install RET htmlize` is required, else you get empty
    ;;   code blocks https://github.com/punchagan/org2blog/blob/master/org2blog.el
    ;; * with wp-use-sourcecode-shortcode set to 't, org2blog will use 1
    ;;   shortcodes, and hence the SyntaxHighlighter Evolved plugin on your blog.
    ;;   however, if you set this to nil, native Emacs highlighting will be used,
    ;;   implemented as HTML styling. Your pick!
    (setq org2blog/wp-use-sourcecode-shortcode 't)
    ;; removed light="true"
    (setq org2blog/wp-sourcecode-default-params nil)
    ;; target language needs to be in here
    (setq org2blog/wp-sourcecode-langs
	  '("actionscript3" "bash" "coldfusion" "cpp" "csharp" "css" "delphi"
	    "erlang" "fsharp" "diff" "groovy" "javascript" "java" "javafx" "matlab"
	    "objc" "perl" "php" "text" "powershell" "python" "ruby" "scala" "sql"
	    "vb" "xml"
	    "sh" "emacs-lisp" "lisp" "lua"))

    ;; this will use emacs syntax higlighting in your #+BEGIN_SRC
    ;; <language> <your-code> #+END_SRC code blocks.
    (setq org-src-fontify-natively t)
#+END_SRC

** org-mode key bindings

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (define-key org-mode-map (kbd "C-c b d") 'org2blog/wp-post-buffer)
    (define-key org-mode-map (kbd "C-c b p") 'org2blog/wp-post-buffer-and-publish)
    (define-key org-mode-map (kbd "C-c t") 'org-set-tags)
#+END_SRC

** pbcopy

Enable pbcopy, so kill-ring can interact with Mac OS X clipboard:
https://github.com/vmalloc/emacs/blob/master/custom/pbcopy.el

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (require 'pbcopy)
    (turn-on-pbcopy)
#+END_SRC

** yasnippet

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (require 'yasnippet)
    (yas-global-mode 1)
#+END_SRC
** Run org-babel-tangle on saving sean.org

#+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (defun my/tangle-on-save-emacs-config-org-file()
      (when (string= buffer-file-name (file-truename "~/.emacs.d/sean.org"))
	(org-babel-tangle)))

    (add-hook 'after-save-hook 'my/tangle-on-save-emacs-config-org-file)
#+END_SRC

** Helm

#+begin_src emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (require 'helm)
    (helm-mode)
    (require 'helm-projectile)
#+end_src

** Theme

#+begin_src emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (defun theme-init ()
      (load-theme 'solarized-light t)
    )

    (add-hook 'after-init-hook 'theme-init)
#+end_src

** Bookmark+

#+begin_src emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (require 'bookmark+)
#+end_src

** 'my/note and 'my/event

http://thewanderingcoder.com/2015/03/automating-boilerplate-in-org-mode-journalling/

#+begin_src emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (defun my/note (title tags)
      (interactive (list
                     (read-from-minibuffer "Title? ")
                     (read-from-minibuffer "Tags? ")))
      (my/find-or-create-date-headers (format-time-string "%Y-%m-%d 09:00"))
      (org-end-of-subtree)
      (insert "\n\n**** " (format-time-string "%H:%M") ". " title)
      (unless (string= tags "")
        (insert "  :" tags ":")
      )
      (insert "\n" (format-time-string "[%Y-%m-%d %H:%M]") "\n\n"))

    (defun my/event (date end-time)
      (interactive (list
                     (org-read-date)
                     (read-from-minibuffer "end time (e.g. 22:00)? ")))
      (if (eq 1 (length (split-string date)))
        (setq date (concat date " 09:00"))
      )
      (my/find-or-create-date-headers date)
      (goto-char (line-end-position))
      (setq start-time (nth 1 (split-string date)))
      (if (string= start-time nil)
        (setq start-time ""))
      (insert "\n\n**** " start-time ". ")
      (save-excursion
	(if (string= end-time "")
	  (setq timestamp-string date)
	(setq timestamp-string (concat date "-" end-time)))
	(insert "\n<" timestamp-string ">\n\n")))


    (defun my/find-or-create-date-headers (date)
      (setq date-name (format-time-string "%A %-e %B %Y" (date-to-time date)))
      (beginning-of-buffer)
      (setq found (re-search-forward (concat "^\*\*\* " date-name) nil t))
      (if found
          (goto-char (point))
        (my/create-date-headers date)
      )
    )

    (defun my/create-date-headers (date)
      (beginning-of-buffer)
      (setq month-name (format-time-string "%B" (date-to-time date)))
      (setq found (re-search-forward (concat "^\*\* " month-name) nil t))
      (unless found
        (my/create-header-for-month date)
      )
      (my/create-header-for-day date)
    )

    (defun my/create-header-for-month (date)
      (setq added-month nil)
      (setq month (nth 4 (org-parse-time-string date)))
      (setq added-month-name (calendar-month-name month))
      (if (= month 1)
          (my/insert-month-header added-month-name)
      )
      (while (and (not added-month) (> month 1))
        (setq month (1- month))
        (setq month-name (calendar-month-name month))
        (setq found (re-search-forward (concat "^\*\* " month-name) nil t))
        (when found
          (goto-char (point))
          (my/insert-month-header added-month-name)
        )
      )
      (unless added-month
          (my/insert-month-header added-month-name)
      )
    )

    (defun my/insert-month-header (month-name)
      (org-end-of-subtree)
      (insert "\n\n** " month-name)
      (setq added-month t)
    )

    (defun my/create-header-for-day (date)
      (my/go-to-month date)

      (setq header-to-add (format-time-string "%A %-e %B %Y" (date-to-time date)))

      (setq date-list (org-parse-time-string date))
      (setq day (nth 3 date-list))
      (setq month (nth 4 date-list))
      (setq year (nth 5 date-list))
      (setq added-day nil)

      (while (and (not added-day) (> day 1))
        (setq day (1- day))
        (setq day-name (format-time-string "%A %-e %B %Y" (encode-time 0 0 0 day month year)))
        (setq found (re-search-forward (concat "^\*\*\* " day-name) nil t))
        (when found
          (goto-char (point))
          (org-end-of-subtree)
          (insert "\n\n*** " header-to-add)
          (setq added-day t)
        )
      )
      (unless added-day
        (insert "\n\n*** " header-to-add)
      )
    )

    (defun my/go-to-month (date)
      (setq month-name (format-time-string "%B" (date-to-time date)))
      (setq found (re-search-forward (concat "^\*\* " month-name) nil t))
      (when found
        (goto-char (point))
      )
    )
#+end_src

** Hydras

Jump to directories

#+begin_src emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (require 'hydra)
    (global-set-key
      (kbd "C-c j")
      (defhydra hydra-jump (:color blue)
        "jump"
        ("e" (find-file "~/.emacs.d/sean.org") ".emacs.d")
        ("c" (find-file "~/.emacs.d/Cask") "Cask")

        ("oi" (find-file "~/code/inventory/") "invent")
        ("oo" (find-file "~/code/optics/") "optics")

        ("a" (find-file "~/code/autrui/") "autrui")
        ("h" (find-file "~/Dropbox/gesta/2015.org") "hodie")
        ("r" (find-file "~/Dropbox/gesta/readings.org") "readings")
        ("w" (find-file "~/Dropbox/gesta/writings.org") "writings")
        ("t" (find-file "~/Dropbox/gesta/twc/") "twc")
        ("v" (find-file "~/Dropbox/gesta/verdour.org") "verdour")))

#+end_src

Switch modes.  (Because org-babel-tangle interacts with emacs-lisp mode)

#+begin_src emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (global-set-key
      (kbd "C-c m")
      (defhydra hydra-mode-switch (:color blue)
        "mode-switch"
        ("e" (emacs-lisp-mode) "emacs-lisp")
        ("l" (linum-mode) "linum")
        ("o" (org-mode) "org")
        ("p" (paredit-mode) "paredit")
        ("t" (typo-mode) "typo")
        ("g" (my/margins) "margins")))
#+end_src

Ace jumps

#+begin_src emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (global-set-key
      (kbd "C-c e")
      (defhydra hydra-ace-jump (:color blue)
        "ace-jump"
        ("c" (ace-jump-mode) "char")
        ("l" (ace-jump-line-mode) "line")
        ("w" (ace-jump-word-mode) "word")))
#+end_src

** guide-key, all the time

#+begin_src emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
    (require 'guide-key)
    (setq guide-key/guide-key-sequence t)
    (guide-key-mode 1)
#+end_src

** helm-ag key binding

#+begin_src emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
  (global-set-key (kbd "C-c s") 'helm-ag-project-root)
#+end_src

** neotree-toggle key binding

#+begin_src emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
  (global-set-key [f8] 'neotree-toggle)
#+end_src

** javascript / coffeescript indent 2 spaces

#+begin_src emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
  (custom-set-variables '(coffee-tab-width 2))
  (setq-default js2-basic-offset 2)
#+end_src

** github-flavored-markdown

#+begin_src emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
  (setq markdown-command "~/.emacs.d/flavor.rb")
#+end_src

** margins

#+begin_src emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
 (setq-default left-margin-width 4 right-margin-width 1)
 (set-window-buffer nil (current-buffer))

  (defun my/margins ()
    "set default margins 4 / 1"
    (interactive)
    (setq-default left-margin-width 4 right-margin-width 1)
    (set-window-buffer nil (current-buffer))
  )
#+end_src

** Emergency colors

#+begin_src emacs-lisp :tangle ~/.emacs.d/tangled-settings.el
(defmacro tty-color-define-1 (n c r g b)
  `(tty-color-define ,n ,c (list (* 257 ,r) (* 257 ,g) (* 257 ,b))))
 (defun tty-color-closest-to-rgb-txt ()
  "define the colors"
  (tty-color-define-1 "grey22" 16 55 55 55)
  (tty-color-define-1 "DarkSlateGrey" 17 55 55 95)
  (tty-color-define-1 "SlateBlue4" 18 55 55 135)
  (tty-color-define-1 "SlateBlue4" 19 55 55 175)
  (tty-color-define-1 "RoyalBlue3" 20 55 55 215)
  (tty-color-define-1 "RoyalBlue2" 21 55 55 255)
  (tty-color-define-1 "DarkSlateGrey" 22 55 95 55)
  (tty-color-define-1 "DarkSlateGrey" 23 55 95 95)
  (tty-color-define-1 "SteelBlue4" 24 55 95 135)
  (tty-color-define-1 "RoyalBlue3" 25 55 95 175)
  (tty-color-define-1 "RoyalBlue3" 26 55 95 215)
  (tty-color-define-1 "RoyalBlue2" 27 55 95 255)
  (tty-color-define-1 "ForestGreen" 28 55 135 55)
  (tty-color-define-1 "SeaGreen4" 29 55 135 95)
  (tty-color-define-1 "aquamarine4" 30 55 135 135)
  (tty-color-define-1 "SteelBlue" 31 55 135 175)
  (tty-color-define-1 "SteelBlue3" 32 55 135 215)
  (tty-color-define-1 "RoyalBlue1" 33 55 135 255)
  (tty-color-define-1 "LimeGreen" 34 55 175 55)
  (tty-color-define-1 "MediumSeaGreen" 35 55 175 95)
  (tty-color-define-1 "MediumSeaGreen" 36 55 175 135)
  (tty-color-define-1 "LightSeaGreen" 37 55 175 175)
  (tty-color-define-1 "SteelBlue3" 38 55 175 215)
  (tty-color-define-1 "DodgerBlue1" 39 55 175 255)
  (tty-color-define-1 "LimeGreen" 40 55 215 55)
  (tty-color-define-1 "SeaGreen3" 41 55 215 95)
  (tty-color-define-1 "SeaGreen3" 42 55 215 135)
  (tty-color-define-1 "MediumTurquoise" 43 55 215 175)
  (tty-color-define-1 "turquoise" 44 55 215 215)
  (tty-color-define-1 "turquoise" 45 55 215 255)
  (tty-color-define-1 "LimeGreen" 46 55 255 55)
  (tty-color-define-1 "SeaGreen2" 47 55 255 95)
  (tty-color-define-1 "SeaGreen2" 48 55 255 135)
  (tty-color-define-1 "SeaGreen1" 49 55 255 175)
  (tty-color-define-1 "turquoise" 50 55 255 215)
  (tty-color-define-1 "cyan1" 51 55 255 255)
  (tty-color-define-1 "grey27" 52 95 55 55)
  (tty-color-define-1 "grey32" 53 95 55 95)
  (tty-color-define-1 "MediumPurple4" 54 95 55 135)
  (tty-color-define-1 "MediumPurple4" 55 95 55 175)
  (tty-color-define-1 "purple3" 56 95 55 215)
  (tty-color-define-1 "BlueViolet" 57 95 55 255)
  (tty-color-define-1 "DarkOliveGreen" 58 95 95 55)
  (tty-color-define-1 "grey37" 59 95 95 95)
  (tty-color-define-1 "MediumPurple4" 60 95 95 135)
  (tty-color-define-1 "SlateBlue3" 61 95 95 175)
  (tty-color-define-1 "SlateBlue3" 62 95 95 215)
  (tty-color-define-1 "RoyalBlue1" 63 95 95 255)
  (tty-color-define-1 "DarkOliveGreen4" 64 95 135 55)
  (tty-color-define-1 "DarkSeaGreen4" 65 95 135 95)
  (tty-color-define-1 "PaleTurquoise4" 66 95 135 135)
  (tty-color-define-1 "SteelBlue" 67 95 135 175)
  (tty-color-define-1 "SteelBlue3" 68 95 135 215)
  (tty-color-define-1 "CornflowerBlue" 69 95 135 255)
  (tty-color-define-1 "DarkOliveGreen4" 70 95 175 55)
  (tty-color-define-1 "DarkSeaGreen4" 71 95 175 95)
  (tty-color-define-1 "CadetBlue" 72 95 175 135)
  (tty-color-define-1 "CadetBlue" 73 95 175 175)
  (tty-color-define-1 "SkyBlue3" 74 95 175 215)
  (tty-color-define-1 "SteelBlue1" 75 95 175 255)
  (tty-color-define-1 "LimeGreen" 76 95 215 55)
  (tty-color-define-1 "PaleGreen3" 77 95 215 95)
  (tty-color-define-1 "SeaGreen3" 78 95 215 135)
  (tty-color-define-1 "aquamarine3" 79 95 215 175)
  (tty-color-define-1 "MediumTurquoise" 80 95 215 215)
  (tty-color-define-1 "SteelBlue1" 81 95 215 255)
  (tty-color-define-1 "chartreuse2" 82 95 255 55)
  (tty-color-define-1 "SeaGreen2" 83 95 255 95)
  (tty-color-define-1 "SeaGreen1" 84 95 255 135)
  (tty-color-define-1 "SeaGreen1" 85 95 255 175)
  (tty-color-define-1 "aquamarine1" 86 95 255 215)
  (tty-color-define-1 "DarkSlateGray2" 87 95 255 255)
  (tty-color-define-1 "IndianRed4" 88 135 55 55)
  (tty-color-define-1 "HotPink4" 89 135 55 95)
  (tty-color-define-1 "MediumOrchid4" 90 135 55 135)
  (tty-color-define-1 "DarkOrchid" 91 135 55 175)
  (tty-color-define-1 "BlueViolet" 92 135 55 215)
  (tty-color-define-1 "purple1" 93 135 55 255)
  (tty-color-define-1 "tan4" 94 135 95 55)
  (tty-color-define-1 "LightPink4" 95 135 95 95)
  (tty-color-define-1 "plum4" 96 135 95 135)
  (tty-color-define-1 "MediumPurple3" 97 135 95 175)
  (tty-color-define-1 "MediumPurple3" 98 135 95 215)
  (tty-color-define-1 "SlateBlue1" 99 135 95 255)
  (tty-color-define-1 "LightGoldenrod4" 100 135 135 55)
  (tty-color-define-1 "wheat4" 101 135 135 95)
  (tty-color-define-1 "grey53" 102 135 135 135)
  (tty-color-define-1 "LightSlateGrey" 103 135 135 175)
  (tty-color-define-1 "MediumPurple" 104 135 135 215)
  (tty-color-define-1 "LightSlateBlue" 105 135 135 255)
  (tty-color-define-1 "OliveDrab3" 106 135 175 55)
  (tty-color-define-1 "DarkOliveGreen3" 107 135 175 95)
  (tty-color-define-1 "DarkSeaGreen" 108 135 175 135)
  (tty-color-define-1 "LightSkyBlue3" 109 135 175 175)
  (tty-color-define-1 "LightSkyBlue3" 110 135 175 215)
  (tty-color-define-1 "SkyBlue2" 111 135 175 255)
  (tty-color-define-1 "OliveDrab3" 112 135 215 55)
  (tty-color-define-1 "DarkOliveGreen3" 113 135 215 95)
  (tty-color-define-1 "PaleGreen3" 114 135 215 135)
  (tty-color-define-1 "DarkSeaGreen3" 115 135 215 175)
  (tty-color-define-1 "DarkSlateGray3" 116 135 215 215)
  (tty-color-define-1 "SkyBlue1" 117 135 215 255)
  (tty-color-define-1 "GreenYellow" 118 135 255 55)
  (tty-color-define-1 "LightGreen" 119 135 255 95)
  (tty-color-define-1 "LightGreen" 120 135 255 135)
  (tty-color-define-1 "PaleGreen1" 121 135 255 175)
  (tty-color-define-1 "aquamarine1" 122 135 255 215)
  (tty-color-define-1 "DarkSlateGray1" 123 135 255 255)
  (tty-color-define-1 "brown" 124 175 55 55)
  (tty-color-define-1 "maroon" 125 175 55 95)
  (tty-color-define-1 "VioletRed3" 126 175 55 135)
  (tty-color-define-1 "DarkOrchid" 127 175 55 175)
  (tty-color-define-1 "DarkOrchid2" 128 175 55 215)
  (tty-color-define-1 "DarkOrchid1" 129 175 55 255)
  (tty-color-define-1 "sienna" 130 175 95 55)
  (tty-color-define-1 "IndianRed" 131 175 95 95)
  (tty-color-define-1 "HotPink3" 132 175 95 135)
  (tty-color-define-1 "MediumOrchid3" 133 175 95 175)
  (tty-color-define-1 "MediumOrchid" 134 175 95 215)
  (tty-color-define-1 "MediumPurple2" 135 175 95 255)
  (tty-color-define-1 "tan3" 136 175 135 55)
  (tty-color-define-1 "LightSalmon3" 137 175 135 95)
  (tty-color-define-1 "RosyBrown" 138 175 135 135)
  (tty-color-define-1 "grey63" 139 175 135 175)
  (tty-color-define-1 "MediumPurple2" 140 175 135 215)
  (tty-color-define-1 "MediumPurple1" 141 175 135 255)
  (tty-color-define-1 "OliveDrab3" 142 175 175 55)
  (tty-color-define-1 "DarkKhaki" 143 175 175 95)
  (tty-color-define-1 "NavajoWhite3" 144 175 175 135)
  (tty-color-define-1 "grey69" 145 175 175 175)
  (tty-color-define-1 "LightSteelBlue3" 146 175 175 215)
  (tty-color-define-1 "LightSteelBlue" 147 175 175 255)
  (tty-color-define-1 "OliveDrab2" 148 175 215 55)
  (tty-color-define-1 "DarkOliveGreen3" 149 175 215 95)
  (tty-color-define-1 "DarkSeaGreen3" 150 175 215 135)
  (tty-color-define-1 "DarkSeaGreen2" 151 175 215 175)
  (tty-color-define-1 "LightCyan3" 152 175 215 215)
  (tty-color-define-1 "LightSkyBlue1" 153 175 215 255)
  (tty-color-define-1 "GreenYellow" 154 175 255 55)
  (tty-color-define-1 "DarkOliveGreen2" 155 175 255 95)
  (tty-color-define-1 "PaleGreen1" 156 175 255 135)
  (tty-color-define-1 "DarkSeaGreen2" 157 175 255 175)
  (tty-color-define-1 "DarkSeaGreen1" 158 175 255 215)
  (tty-color-define-1 "PaleTurquoise1" 159 175 255 255)
  (tty-color-define-1 "brown3" 160 215 55 55)
  (tty-color-define-1 "VioletRed3" 161 215 55 95)
  (tty-color-define-1 "VioletRed3" 162 215 55 135)
  (tty-color-define-1 "maroon2" 163 215 55 175)
  (tty-color-define-1 "MediumOrchid" 164 215 55 215)
  (tty-color-define-1 "DarkOrchid1" 165 215 55 255)
  (tty-color-define-1 "sienna3" 166 215 95 55)
  (tty-color-define-1 "IndianRed" 167 215 95 95)
  (tty-color-define-1 "HotPink3" 168 215 95 135)
  (tty-color-define-1 "HotPink2" 169 215 95 175)
  (tty-color-define-1 "orchid" 170 215 95 215)
  (tty-color-define-1 "MediumOrchid1" 171 215 95 255)
  (tty-color-define-1 "tan3" 172 215 135 55)
  (tty-color-define-1 "LightSalmon3" 173 215 135 95)
  (tty-color-define-1 "LightPink3" 174 215 135 135)
  (tty-color-define-1 "pink3" 175 215 135 175)
  (tty-color-define-1 "plum3" 176 215 135 215)
  (tty-color-define-1 "violet" 177 215 135 255)
  (tty-color-define-1 "goldenrod" 178 215 175 55)
  (tty-color-define-1 "LightGoldenrod3" 179 215 175 95)
  (tty-color-define-1 "tan" 180 215 175 135)
  (tty-color-define-1 "MistyRose3" 181 215 175 175)
  (tty-color-define-1 "thistle3" 182 215 175 215)
  (tty-color-define-1 "plum2" 183 215 175 255)
  (tty-color-define-1 "OliveDrab2" 184 215 215 55)
  (tty-color-define-1 "khaki3" 185 215 215 95)
  (tty-color-define-1 "LightGoldenrod2" 186 215 215 135)
  (tty-color-define-1 "LightYellow3" 187 215 215 175)
  (tty-color-define-1 "grey84" 188 215 215 215)
  (tty-color-define-1 "LightSteelBlue1" 189 215 215 255)
  (tty-color-define-1 "OliveDrab1" 190 215 255 55)
  (tty-color-define-1 "DarkOliveGreen1" 191 215 255 95)
  (tty-color-define-1 "DarkOliveGreen1" 192 215 255 135)
  (tty-color-define-1 "DarkSeaGreen1" 193 215 255 175)
  (tty-color-define-1 "honeydew2" 194 215 255 215)
  (tty-color-define-1 "LightCyan1" 195 215 255 255)
  (tty-color-define-1 "firebrick1" 196 255 55 55)
  (tty-color-define-1 "brown1" 197 255 55 95)
  (tty-color-define-1 "VioletRed1" 198 255 55 135)
  (tty-color-define-1 "maroon1" 199 255 55 175)
  (tty-color-define-1 "maroon1" 200 255 55 215)
  (tty-color-define-1 "magenta1" 201 255 55 255)
  (tty-color-define-1 "tomato1" 202 255 95 55)
  (tty-color-define-1 "IndianRed1" 203 255 95 95)
  (tty-color-define-1 "IndianRed1" 204 255 95 135)
  (tty-color-define-1 "HotPink" 205 255 95 175)
  (tty-color-define-1 "HotPink" 206 255 95 215)
  (tty-color-define-1 "MediumOrchid1" 207 255 95 255)
  (tty-color-define-1 "sienna1" 208 255 135 55)
  (tty-color-define-1 "salmon1" 209 255 135 95)
  (tty-color-define-1 "LightCoral" 210 255 135 135)
  (tty-color-define-1 "PaleVioletRed1" 211 255 135 175)
  (tty-color-define-1 "orchid2" 212 255 135 215)
  (tty-color-define-1 "orchid1" 213 255 135 255)
  (tty-color-define-1 "goldenrod1" 214 255 175 55)
  (tty-color-define-1 "SandyBrown" 215 255 175 95)
  (tty-color-define-1 "LightSalmon1" 216 255 175 135)
  (tty-color-define-1 "LightPink1" 217 255 175 175)
  (tty-color-define-1 "pink1" 218 255 175 215)
  (tty-color-define-1 "plum1" 219 255 175 255)
  (tty-color-define-1 "goldenrod1" 220 255 215 55)
  (tty-color-define-1 "LightGoldenrod2" 221 255 215 95)
  (tty-color-define-1 "LightGoldenrod2" 222 255 215 135)
  (tty-color-define-1 "NavajoWhite1" 223 255 215 175)
  (tty-color-define-1 "MistyRose1" 224 255 215 215)
  (tty-color-define-1 "thistle1" 225 255 215 255)
  (tty-color-define-1 "yellow1" 226 255 255 55)
  (tty-color-define-1 "LightGoldenrod1" 227 255 255 95)
  (tty-color-define-1 "khaki1" 228 255 255 135)
  (tty-color-define-1 "wheat1" 229 255 255 175)
  (tty-color-define-1 "cornsilk1" 230 255 255 215)
  (tty-color-define-1 "grey100" 231 255 255 255)
  (tty-color-define-1 "grey3" 232 8 8 8)
  (tty-color-define-1 "grey7" 233 18 18 18)
  (tty-color-define-1 "grey11" 234 28 28 28)
  (tty-color-define-1 "grey15" 235 38 38 38)
  (tty-color-define-1 "grey19" 236 48 48 48)
  (tty-color-define-1 "grey23" 237 58 58 58)
  (tty-color-define-1 "grey27" 238 68 68 68)
  (tty-color-define-1 "grey31" 239 78 78 78)
  (tty-color-define-1 "grey35" 240 88 88 88)
  (tty-color-define-1 "grey39" 241 98 98 98)
  (tty-color-define-1 "grey42" 242 108 108 108)
  (tty-color-define-1 "grey46" 243 118 118 118)
  (tty-color-define-1 "grey50" 244 128 128 128)
  (tty-color-define-1 "grey54" 245 138 138 138)
  (tty-color-define-1 "grey58" 246 148 148 148)
  (tty-color-define-1 "grey62" 247 158 158 158)
  (tty-color-define-1 "grey66" 248 168 168 168)
  (tty-color-define-1 "grey70" 249 178 178 178)
  (tty-color-define-1 "grey74" 250 188 188 188)
  (tty-color-define-1 "grey78" 251 198 198 198)
  (tty-color-define-1 "grey82" 252 208 208 208)
  (tty-color-define-1 "grey86" 253 218 218 218)
  (tty-color-define-1 "grey90" 254 228 228 228)
  (tty-color-define-1 "grey93" 255 238 238 238))
 (tty-color-closest-to-rgb-txt) ; finally activate it.
#+end_src
